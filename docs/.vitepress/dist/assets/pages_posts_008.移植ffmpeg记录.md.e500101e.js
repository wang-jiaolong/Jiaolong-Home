import{_ as l,D as o,o as p,c as t,z as n,a,t as c,G as r,O as i}from"./chunks/framework.89d0ee0c.js";const k=JSON.parse('{"title":"移植FFmpeg到RISC-V记录","description":"","frontmatter":{"title":"移植FFmpeg到RISC-V记录","date":"2022-08-24T15:27:08.000Z"},"headers":[],"relativePath":"pages/posts/008.移植ffmpeg记录.md","filePath":"pages/posts/008.移植ffmpeg记录.md"}'),d={name:"pages/posts/008.移植ffmpeg记录.md"},C={id:"frontmatter-title",tabindex:"-1"},g=n("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{ $frontmatter.title }} <Badge type="tip" :text="String($frontmatter.date).slice(0,10)" />"'},"​",-1),u=i(`<h2 id="configure" tabindex="-1">./configure <a class="header-anchor" href="#configure" aria-label="Permalink to &quot;./configure&quot;">​</a></h2><p>一般手动编译分三步， configure 配置， make 编译 make install 安装</p><p>常规配置方法：</p><p>查看帮助选项<code>./configure help</code>，如果帮助选项中有 build 选项，只需在命令行加<code> --build=riscv64-unknown-elf</code></p><p>少部分程序在 configure help 没有 build 选项，需要手动运行 config.guess脚本 ，检测系统体系结构。</p><blockquote><p>riscv64-unknown-linux-gnu-gcc</p></blockquote><h2 id="_1-编译-yasm" tabindex="-1">1. 编译 yasm <a class="header-anchor" href="#_1-编译-yasm" aria-label="Permalink to &quot;1. 编译 yasm&quot;">​</a></h2><blockquote><p>yasm是一个 汇编编译器，后面编译 x264 需要用到它，它能加快编译速度。</p></blockquote><p>进入解压过的yasm文件夹</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">./configure --prefix=/usr/local --build=riscv64-unknown-linux-gnu</span></span></code></pre></div><h2 id="_2-编译pkg-config" tabindex="-1">2. 编译pkg-config <a class="header-anchor" href="#_2-编译pkg-config" aria-label="Permalink to &quot;2. 编译pkg-config&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">./configure --prefix=/usr/local --build=riscv64-unknown-linux-gnu --with-internal-glib</span></span></code></pre></div><h2 id="_3-编译-libx264" tabindex="-1">3. 编译 libx264 <a class="header-anchor" href="#_3-编译-libx264" aria-label="Permalink to &quot;3. 编译 libx264&quot;">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">./configure  --enable-shared --enable-static --prefix=/usr/local</span></span></code></pre></div><h2 id="ffmpeg编译configure" tabindex="-1">ffmpeg编译configure <a class="header-anchor" href="#ffmpeg编译configure" aria-label="Permalink to &quot;ffmpeg编译configure&quot;">​</a></h2><p>在ffmpeg目录下，查看所有可配置选项</p><div class="language-assembly"><button title="Copy Code" class="copy"></button><span class="lang">assembly</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">./configure --help</span></span></code></pre></div><ul><li><p><code>–-arch</code>可以指定架构</p><p>可选值可在configure里搜索<code>ARCH_LIST</code>查看</p></li><li><p><code>--prefix</code> 安装程序到指定目录（默认/usr/local）</p></li><li><p><code>--cross-prefix</code> ：编译工具路径</p></li><li><p><code>--enable-cross-compile</code>：启用交叉编译器</p></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">./configure --cross-prefix=riscv64-unknown-linux-gnu- </span></span>
<span class="line"><span style="color:#A6ACCD;">			--enable-cross-compile </span></span>
<span class="line"><span style="color:#A6ACCD;">			--target-os=linux </span></span>
<span class="line"><span style="color:#A6ACCD;">			--cc=riscv64-unknown-linux-gnu-gcc </span></span>
<span class="line"><span style="color:#A6ACCD;">			--arch=riscv </span></span>
<span class="line"><span style="color:#A6ACCD;">			--prefix=/usr/local/ffmpeg </span></span>
<span class="line"><span style="color:#A6ACCD;">			--pkg-config=true </span></span>
<span class="line"><span style="color:#A6ACCD;">			--pkgconfigdir=/usr/local/pkg-config </span></span>
<span class="line"><span style="color:#A6ACCD;">			--enable-ffmpeg --disable-armv5te --disable-armv6 --disable-armv6t2</span></span></code></pre></div><p>综合：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">./configure --cross-prefix=riscv64-unknown-linux-gnu- --enable-cross-compile --target-os=linux --cc=riscv64-unknown-linux-gnu-gcc --arch=riscv --prefix=/usr/local/ffmpeg --pkg-config=true --pkgconfigdir=/usr/local/pkg-config --enable-ffmpeg --disable-armv5te --disable-armv6 --disable-armv6t2</span></span></code></pre></div><h2 id="报错记录" tabindex="-1">报错记录 <a class="header-anchor" href="#报错记录" aria-label="Permalink to &quot;报错记录&quot;">​</a></h2><ol><li><code>WARNING: riscv64-unknown-elf-pkg-config not found, library detection may fail.</code></li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">collect2: error: ld returned 1 exit status</span></span>
<span class="line"><span style="color:#A6ACCD;">make: *** [Makefile:131: ffmpeg_g] Error 1</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">--pkg-config</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;"> --pkgconfigdir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/local/pkt-config</span></span></code></pre></div><ol start="2"><li><code>error: &#39;PATH_MAX&#39; undeclared here (not in a function)</code></li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">In</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">file</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">included</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">libavcodec/v4l2_buffers.c:34:</span></span>
<span class="line"><span style="color:#FFCB6B;">libavcodec/v4l2_m2m.h:44:18:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">error:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PATH_MAX</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undeclared</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">here</span><span style="color:#A6ACCD;"> (not </span><span style="color:#C3E88D;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">function</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">44</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">     </span><span style="color:#FFCB6B;">char</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">devname[PATH_MAX]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                  </span><span style="color:#FFCB6B;">^~~~~~~~</span></span>
<span class="line"><span style="color:#FFCB6B;">make:</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">***</span><span style="color:#A6ACCD;"> [ffbuild/common.mak:81: </span><span style="color:#C3E88D;">libavcodec/v4l2_buffers.o]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Error</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span></code></pre></div><p>解决方案：</p><p>检查该文件，并引入头文件</p><div class="language-C"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">linux/limits.h</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div>`,30);function y(s,f,A,m,h,D){const e=o("Badge");return p(),t("div",null,[n("h1",C,[a(c(s.$frontmatter.title)+" ",1),r(e,{type:"tip",text:String(s.$frontmatter.date).slice(0,10)},null,8,["text"]),a(),g]),u])}const _=l(d,[["render",y]]);export{k as __pageData,_ as default};
