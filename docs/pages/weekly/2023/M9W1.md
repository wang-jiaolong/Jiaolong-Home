---
title: 重构进度：10%
date: 2023-09-11
week: M9W2
---

### bugfix：

修复了很久之外的一个问题：用户在用拾色器自定义颜色时可能会使用P3和sRGB空间的色域，之前由于没有做区分导致了从hexString到颜色的过程有误，本来以为会再字符串上做区分后来查过才知道用十进制的表示方式是一样的，但是同样的色值在不同色域下的表现是不一样的。

> 不同色彩空间的 **`color.toHexString()`** 函数定义是一致的，因为颜色空间不影响颜色对象本身的十六进制表示。无论颜色是在 P3 色彩空间还是 sRGB 色彩空间创建的，它们的十六进制表示方法都是相同的。
> 
> 
> 颜色的十六进制表示通常是通过提取颜色的红、绿和蓝分量（以及可选的 alpha 分量）的值并将它们格式化为十六进制字符串来生成的。这个过程与颜色的色彩空间无关，因为颜色的十六进制表示只是一种用于表示颜色的通用方式。
> 
> 因此，无论颜色是在 P3 色彩空间还是 sRGB 色彩空间创建的，你可以使用相同的 **`color.toHexString()`** 函数来将其转换为十六进制字符串表示。不需要区分颜色空间来执行这个操作。
>

### 为app增加了埋点

其实很久之前就可以加了，一直没有去做的原因是即使我拿到了埋点数据我也不知道该如何利用，现在在一些功能的选择上可以做一些参考，看哪些按钮是用户不会经常点击的，哪些路径是极少发生的。

### 重构进度：10%

在进行project的数据层重构时本想一点一点来的，没想到一层一层关联的太多了，不得已把大部分都给改正了，还有些细节需要慢慢补充。View层暂时没有进行重构，太多… 

### 优化

[嵌套UIKit：UIPageViewController代替TabView](/pages/blogs/025.UIPageViewController.md) 

完成了tabview的优化，并输出文章。还有些细节需要补充下，一些小坑。比如数据更新后但controllers没有更新，导致下标越界。

### 探究

[****数据流ObservedObject探究****](../../blogs/026.ObservedObject.md) 

在重新探究了ObservedObject后发现代码里很多都是在做无用功，于是把大部分不需要的地方精简掉。

期间遇到一个问题一个子视图的envirment没有对应的实例，在反复排查后发现是在用肘子哥的navigation轮子时，在向后传递时会丢失实例，必须使用.envirmentObject（）手动传递。

界面重新按设计师的方案修改了下，之前的确实层级比较多，目前的方案要比之前自己想的好了不少。只用敲代码的感觉真好啊 哈哈哈哈哈。

公众号里的周记到底还是没坚持下来，明天白天摸鱼的时候写写吧，看了大佬的blog，觉得没必要每周都去硬凑一篇，如果没内容输出要去硬凑不就变成流水账了，所以不如把输出的文章分为两类，流水账/一些思考。就这么办

好久没打开小红书，最近开始开放内测顺便把堆积了一段时间的用户问题解决了。